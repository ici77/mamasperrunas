<!-- ğŸ“Œ Contenedor principal -->
<div class="container-fluid mt-4" *ngIf="post">
  <div class="row d-flex align-items-stretch">

    <!-- ğŸ“Œ MenÃº Lateral Izquierdo -->
    <aside class="col-12 col-md-3 col-lg-2 sidebar-left">
      <h3>Foro</h3>

      <!-- ğŸ“Œ Tarjetas debajo del MenÃº Izquierdo -->
      <div class="info-card" *ngFor="let i of [1,2,3]">
        <h4>InformaciÃ³n Importante</h4>
        <img src="assets/images/categoria-fondo.jpg" alt="InformaciÃ³n destacada">
        <p>Lee las Ãºltimas novedades en el foro.</p>
        <a href="/foro" class="btn btn-secondary">MÃ¡s detalles</a>
      </div>
    </aside>

    <!-- ğŸ“Œ Zona Principal del Post -->
    <div class="col-12 col-md-6 col-lg-7 d-flex flex-column">

      <!-- ğŸ“Œ Migas de pan -->
      <nav aria-label="breadcrumb" class="breadcrumb-container">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a routerLink="/">ğŸ  Inicio</a></li>
          <li class="breadcrumb-item"><a routerLink="/foro">ğŸ“¢ Foro</a></li>
          <li class="breadcrumb-item">
            <a [routerLink]="['/foro', post?.category?.name]">ğŸ¾ {{ post?.category?.name || 'CategorÃ­a' }}</a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">ğŸ“„ Post</li>
        </ol>
      </nav>

      <!-- ğŸ“Œ Cabecera con Imagen -->
      <header class="category-header col-12">
        <img src="assets/images/categoria-fondo.jpg" alt="CategorÃ­a {{ post?.category?.name }}" class="header-image">
        <h1>{{ post?.category?.name | titlecase }}</h1>
      </header>

      <!-- ğŸ“¸ Imagen del post -->
      <div class="d-flex justify-content-center mb-3" *ngIf="post?.imagenUrl">
        <img 
          [src]="'http://localhost:8080' + post.imagenUrl"
          alt="Imagen del post"
          class="img-thumbnail shadow"
          style="max-width: 300px; border-radius: 12px;">
      </div>

      <!-- ğŸ“Œ Contenido del post -->
      <div class="card post-detail">
        <div class="card-body">
          <h2 class="post-title mb-3 text-success-emphasis">{{ post.title }}</h2>
          <p class="card-text">{{ post.content }}</p>
          <p class="text-muted mt-3">
            ğŸ§‘ Publicado por <strong>{{ post.user?.nombre || 'AnÃ³nimo' }}</strong>
            el {{ post.createdAt | date:'short' }}
          </p>
        </div>
      </div>

      <!-- ğŸ“Œ Estado de carga / error -->
      <div *ngIf="isLoading" class="alert alert-info mt-3">
        â³ Cargando post...
      </div>
      <div *ngIf="errorMessage" class="alert alert-danger mt-3">
        âŒ {{ errorMessage }}
      </div>

     <!-- ğŸ“Œ Acciones -->
<div class="post-actions d-flex flex-wrap align-items-center gap-2 mt-3" *ngIf="!isLoading">

  <!-- ğŸ‘ Like con corazÃ³n dinÃ¡mico -->
  <button class="btn btn-outline-danger" (click)="toggleLike()">
    <i class="fa" [ngClass]="yaDioLike ? 'fa-heart text-danger' : 'fa-heart-o text-secondary'"></i>
    <span [ngClass]="yaDioLike ? 'text-danger fw-bold' : 'text-dark'">{{ totalLikes }}</span>
  </button>

  <!-- ğŸ‘ Dislike -->
  <button class="btn btn-outline-secondary" (click)="toggleDislike()">
    ğŸ‘ <span class="badge bg-light text-dark">{{ totalDislikes }}</span>
  </button>

  <!-- â­ Favorito: alterna aÃ±adir/quitar -->
  <button 
    class="btn btn-outline-warning"
    (click)="marcarFavorito()">
    <i class="fa fa-star" [ngClass]="yaEsFavorito ? 'text-warning' : 'text-secondary'"></i>
    {{ yaEsFavorito ? ' Guardado' : ' AÃ±adir a favoritos' }}
  </button>

  <!-- ğŸš© Reportar: alterna aÃ±adir/quitar -->
  <button 
    class="btn btn-outline-danger"
    (click)="reportarPost()">
    <i class="fa fa-flag"></i> {{ yaReportado ? ' Reportado' : ' Reportar' }}
  </button>
</div>



     <!-- ğŸ“Œ Formulario de respuesta -->
<div class="card mt-4 respuesta-form" *ngIf="!isLoading">
  <div class="card-header bg-light">
    <h4 class="mb-0">Tu respuesta</h4>
  </div>
  <div class="card-body">
    <textarea 
      [(ngModel)]="respuestaTexto" 
      placeholder="Escribe tu respuesta..."
      class="form-control"
      rows="4"
      maxlength="300"
      name="respuestaTexto">
    </textarea>

    <!-- Contador dinÃ¡mico con clases -->
<p class="mt-2 text-end"
   [ngClass]="{
     'contador-rojo': (respuestaTexto || '').length >= 300,
     'contador-gris': (respuestaTexto || '').length < 50,
     'contador-verde': (respuestaTexto || '').length >= 50 && (respuestaTexto || '').length < 300
   }">
  {{ (respuestaTexto || '').length }}/300 caracteres
  <span *ngIf="(respuestaTexto || '').length < 50" class="text-muted ms-2">(mÃ­nimo 50 caracteres)</span>
</p>



    <!-- BotÃ³n deshabilitado si menos de 50 o mÃ¡s de 300 -->
    <button 
      class="btn btn-success mt-2"
      (click)="responder()"
      [disabled]="!respuestaTexto || respuestaTexto.trim().length < 50 || respuestaTexto.length > 300">
      ğŸ“¨ Responder
    </button>
  </div>
</div>

      <!-- ğŸ“Œ Lista de respuestas -->
      <div class="mt-4" *ngIf="respuestas.length > 0">
        <h3 class="mb-3">ğŸ’¬ Respuestas</h3>
        <div *ngFor="let r of respuestas" class="card mb-3 respuesta">
          <div class="card-body">
            <p class="mb-1"><strong>{{ r.user?.nombre || 'Usuario' }}</strong> dijo:</p>
            <p class="mb-0">{{ r.content || r.texto }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ğŸ“Œ Sidebar derecho: Recomendados -->
    <aside class="col-12 col-md-3 col-lg-3 sidebar-right">
      <div class="info-card recomendados mt-3" *ngIf="recentPosts.length > 0">
        <h4>ğŸ‘€ Te puede interesar</h4>
        <div class="d-flex flex-column gap-2">
          <div *ngFor="let recomendado of recentPosts" class="post-recomendado-box">
            <a [routerLink]="['/post', recomendado.id]">ğŸ¶ {{ recomendado.title }}</a>
          </div>
        </div>
      </div>

      <!-- Tarjetas adicionales -->
      <div class="info-card" *ngFor="let i of [1,2]">
        <h4>InformaciÃ³n Importante</h4>
        <img src="assets/images/categoria-fondo.jpg" alt="InformaciÃ³n destacada">
        <p>Lee las Ãºltimas novedades en el foro.</p>
        <a href="/foro" class="btn btn-secondary">MÃ¡s detalles</a>
      </div>
    </aside>

  </div> <!-- Fin .row -->
</div>
